<html>
  <head>
    <meta name="robots" content="noindex,nofollow" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SequoIA</title>
    <meta charset="utf-8" />

    <script type="text/javascript">
      // Passer les données au script principal (main.js)
      var arrayCoordinates = {{ array_coordinates | tojson | safe }};
    </script>

    <link rel="stylesheet" href="./static/css/MarkerCluster.Default.css"/>
    <link rel="stylesheet" href="./static/css/menu.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap-switch-button@1.1.0/css/bootstrap-switch-button.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="//code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="//code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap-switch-button@1.1.0/dist/bootstrap-switch-button.min.js"></script>

    <script type="text/javascript">

      function decimateObject(obj, decimation) {
          const result = {};
          
          // Parcourir les clés de l'objet
          for (const key in obj) {
              if (Object.hasOwnProperty.call(obj, key)) {
                  // Récupérer la valeur associée à la clé
                  const value = obj[key];

                  // Vérifier si la valeur est un tableau et a une longueur
                  if (Array.isArray(value) && value.length > 0) {
                      // Conserver une ligne sur "decimation" (sauter les autres lignes)
                      const decimatedArray = value.filter((_, index) => index % decimation === 0);
                      
                      // Ajouter la clé et le nouveau tableau résultant au résultat
                      result[key] = decimatedArray;
                  } else {
                      // Si la valeur n'est pas un tableau, simplement l'ajouter au résultat
                      result[key] = value;
                  }
              }
          }

          return result;
      }

      // Passer les données au script principal (main.js)
      python_array_coordinates = {{ array_coordinates | tojson | safe }};
      python_sensors = {{ sensors | tojson | safe }};
      python_result = {{ result | tojson | safe }};

      // decimation = 100
      // python_array_coordinates = decimateObject(python_array_coordinates, decimation)
      // python_sensors = decimateObject(python_sensors, decimation)
      // python_result = decimateObject(python_result, decimation)

      var arrayCoordinates = python_array_coordinates;
      var sensors = python_sensors;
      var result = python_result;
    </script>

  </head>
  <body>
    <div id="map" style="height:100%;width:100%"></div>

    <!-- Start menu -->
    <div class="menu">

      <!-- Main menu options: Setup | Calibration | Analysis -->
      <div class="mb-4">
        <!-- ANTONY FOR DEMO ======= Remove buttons -->
        <!-- <button class="btn btn-primary mr-2 main-button" id="setup-button" type="button" data-target="setup-options">Setup</button> -->
        <button class="btn btn-primary mr-2 main-button" id="calib-button" type="button" data-target="calibration-options" disabled>Calibration</button>
        <button class="btn btn-primary main-button" id="analysis-button" type="button" data-target="analysis-options" disabled>Analysis</button>
        <button class="btn btn-danger mx-3 btn-sm" id="clear-button" type="button">Clear map</button> 
      </div>

      <!-- Start setup menu options -->
      <div class="container menu-options" id="setup-options">

        <h1 style="font-size: 20px; font-weight: 1000;">Step 1 : Location file</h1>

        <!-- Start upload cable location file -->
        <div class="row mb-3">
          <div class="col">
            <b>- Option 1</b>: Upload a cable location file (GeoJSON)
          </div>
        </div>

        <!-- Select file -->
        <div class="row mb-1">  
          <div class="col input-group">
            <input type="file" class="form-control" id="cableLocationFile" aria-label="cable">
          </div>
        </div>

        <!-- Specify channel spacing -->
        <div class="row mb-2">
          <div class="col input-group">
            <span class="input-group-text">Channel spacing</span>
            <input type="number" class="form-control" value="10" id="channel-spacing">
            <span class="input-group-text">metre</span>
          </div>
        </div>

        <!-- Submit button -->
        <div class="row mb-3">
          <div class="col">
            <button class="btn btn-outline-secondary upload-file" type="button" data-target="cableLocationFile">Submit</button>
          </div>
        </div>
        <!-- End upload cable location file -->

        <hr />
        <!-- Start upload calibrated location file -->
        <div class="row mb-3">
          <div class="col">
            <b>- Option 2</b>: Upload a calibrated location file
          </div>
        </div>

        <div class="row">
          <div class="col">
            <div class="input-group">
              <input type="file" class="form-control" id="calibLocationFile" aria-label="calib">
              <button class="btn btn-outline-secondary upload-file" type="button" data-target="calibLocationFile">Upload</button>
            </div>
          </div>
        </div>

        <!-- Specify bucket name -->

        <hr />

        <h1 style="font-size: 20px; font-weight: 1000;">Step 2 : Bucket in InfluxDB</h1>
        <!-- Start upload calibrated location file -->
        <div class="row mb-3">
          <div class="col">
            <b>Specify the bucket name in InfluxDB</b>
          </div>
        </div>
        
        <div class="row mb-2">
          <div class="col input-group">
            <span class="input-group-text">Bucket name</span>
            <input type="text" class="form-control" value="MNCA21" id="bucket-name">
            <button class="btn btn-outline-secondary submit-bucket" type="button" data-target="bucket-name">Submit</button>
          </div>
        </div>


        <!-- End upload calibrated location file -->

      </div>
      
      <!-- End setup menu options -->

      <!-- Start calibration options -->
      <div class="container menu-options" id="calibration-options">

        <hr />

        <div class="row mb-2 text-center">
          <div class="col">
            <input class="sw" id="show-cable" type="checkbox" data-toggle="switchbutton" data-onlabel="Toggle cable" data-offlabel="Toggle cable" data-onstyle="success" data-width="150">
            <input class="sw" id="show-markers" type="checkbox" data-toggle="switchbutton" data-onlabel="Toggle markers" data-offlabel="Toggle markers" data-onstyle="success" data-width="150">
            <input class="sw" id="show-satellite" type="checkbox" data-toggle="switchbutton" data-onlabel="Toggle satellite" data-offlabel="Toggle satellite" data-onstyle="success" data-width="150">
          </div>
        </div>


        <hr />

        <!-- Introduction -->
        <!-- <div class="row mb-3">
          <div class="col">Define data ranges for energy data (optional)</div>
        </div> -->

        <!-- Start time -->
        <!-- <div class="row mb-1">
          <div class="col input-group">
            <span class="input-group-text" style="width: 130px;">Start time</span>
            <input type="datetime-local" id="startdatetimecalib" value="2021-12-22T21:35:00" step="1">
          </div>
        </div> -->

        <!-- End time -->
        <!-- <div class="row mb-1">
          <div class="col input-group">
            <span class="input-group-text" style="width: 130px;">End time</span>
            <input type="datetime-local" id="enddatetimecalib" value="2021-12-22T21:36:00" step="1">
          </div>
        </div> -->

        <!-- Channel range -->
        <!-- <div class="row mb-2">
          <div class="col input-group">
            <span class="input-group-text" style="width: 130px;">Channel range</span>
            <input type="number" class="form-control" id="startchcalib" value="700">
            <input type="number" class="form-control" id="endchcalib" value="1000">
          </div>
        </div> -->

        <!-- Submit data range -->
        <!-- <div class="row mb-2">
          <div class="col">
            <button class="btn btn-outline-secondary loadButton" type="button" id="submitDateTimeCalib">Submit</button>
          </div>
        </div>
        
        <hr />

        <div class="row mb-2">
          <div class="col">
            <div id="calibEnergyPanel"></div>
          </div>
        </div>

        <hr />

        <div class="row mb-2">
          <div class="col">
            <button class="btn btn-outline-secondary" type="button" id="download-sensors">Download sensor file</button>
          </div>
        </div>
        
      </div> -->
      <!-- End calibration options -->

      <!-- Start analysis options -->
      <div class="container menu-options" id="analysis-options">

        <div class="row mb-2">
          <div class="col">Data type:</div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <!-- Energy data -->
            <input type="radio" class="btn-check" name="data-type" id="selectEnergy" value="energy" autocomplete="off" checked>
            <label class="btn btn-outline-secondary btn-sm" for="selectEnergy">Energy</label>

            <!-- Strain -->
            <input type="radio" class="btn-check" name="data-type" id="selectStrain" value="strain" autocomplete="off">
            <label class="btn btn-outline-secondary btn-sm" for="selectStrain">Strain</label>
            
            <input type="radio" class=" btn-check" name="data-type" id="selectDenoise" value="denoise" autocomplete="off">
            <label class="btn btn-outline-secondary btn-sm" for="selectDenoise"  style="margin-bottom: 0px;">Denoise</label>

            <!-- Vehicle counts -->
            <input type="radio" class="btn-check" name="data-type" id="selectCounts" value="total_count" autocomplete="off">
            <label class="btn btn-outline-secondary btn-sm" for="selectCounts">Vehicle counts</label>

            <!-- Vehicle speed -->
            <input type="radio" class="btn-check" name="data-type" id="selectSpeed" value="speed" autocomplete="off">
            <label class="btn btn-outline-secondary btn-sm" for="selectSpeed">Vehicle speed</label>
          </div>
        </div>

        <div class="row mb-2">
          <div class="col">Display mode:</div>
        </div>

        <div class="row mb-3">
          <div class="col">
            <!-- Static display -->
            <input type="radio" class="btn-check" name="display-mode" id="selectStatic" value="static" autocomplete="off" checked>
            <label class="btn btn-outline-secondary btn-sm" for="selectStatic">Fixed time</label>

            <!-- Dynamic display -->
            <input type="radio" class="btn-check" name="display-mode" id="selectDynamic" value="dynamic" autocomplete="off">
            <label class="btn btn-outline-secondary btn-sm" for="selectDynamic">Variable time</label>

            <!-- Real time display -->
            <input type="radio" class="btn-check" name="display-mode" id="selectRealtime" value="realtime" autocomplete="off">
            <label class="btn btn-outline-secondary btn-sm" for="selectRealtime">Real time</label>
          </div>
        </div>
    
        <div class="row mb-2">
          <div class="col">Select data range:</div>
        </div>

        <!-- Start time -->
        <div class="row mb-1">
          <div class="col input-group">
            <span class="input-group-texte" style="width: 130px;">Start time</span>
            <input type="datetime-local" id="startdatetimeanalysis" value="2021-12-22T21:31:04" step="1">
          </div>
        </div>

        <!-- End time -->
        <div class="row mb-1">
          <div class="col input-group">
            <span class="input-group-texte" style="width: 130px;">End time</span>
            <input type="datetime-local" id="enddatetimeanalysis" value="2021-12-22T21:32:04" step="1" disabled>
          </div>
        </div>

        <!-- Channel range -->
        <div class="row mb-2">
          <div class="col input-group">
            <span class="input-group-text" style="width: 130px;">Channel range</span>
            <input type="number" class="form-control" id="startchanalysis" value="750">
            <input type="number" class="form-control" id="endchanalysis" value="1000">
          </div>
        </div>

        <!-- Speed range -->
        <div class="row mb-2">
          <div class="col input-group">
            <span class="input-group-textee" style="width: 130px; display: none;">Speed range <br>(Optional)
              <span class="rounded-circle" data-toggle="tooltip" data-placement="top" title="Markers will be shown on the sensors where the speed is within the defined range.">
                <i class="fas fa-info-circle" style="margin-top: 15px;"></i>
              </span>
            </span>
            <input type="number" class="form-control" id="startspeedlysis" style="display: none;">
            <input type="number" class="form-control" id="endspeedlysis" style="display: none;">
          </div>
        </div>
        
      

        <!-- Slider -->
        <div class="slidecontainer">
          <div class="row mb-2">
            <div class="col" id="slide" style="display: none;">Slide to view data : </div>
          </div>
          <input type="range" class="slider" id="myRange" style="display: none;">
          <p>Date & Time: <span id="demo"></span></p>
        </div>

        <!-- Submit data range -->
        <div class="row mb-2">
          <div class="col">
            <button class="btn btn-outline-secondary loadButton" type="button" id="submitDateTimeAnalysis">Submit</button>

        <!-- Stop real time -->
            <button class="btn btn-outline-secondary stopButton" style="display: none;" type="button" id="stopRealTime">Stop Real Time</button>
          </div>
        </div>

        <hr />

        <div class="row mb-2">
          <div class="col">Choose time format before submit to plot : </div>
        </div>
        <div class="row mb-2 text-center">
          <div class="col">
            <input class="sw" id="timeFormat" type="checkbox" data-toggle="switchbutton" data-onlabel="UTC" data-offlabel="Local" data-onstyle="success" data-width="150">
          </div>
        </div>

        <div class="row mb-2">
          <div class="col">
            <div id="analysisEnergyPanel"></div>
          </div>
        </div>

        <div class="row mb-2">
          <div class="col">
            <div id="graph"></div>
          </div>
        </div>



      </div>
      <!-- End analysis options -->

    </div>
    <!-- End menu -->


    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""> 
    </script>
    <script src="http://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="./static/js/leaflet.hotline.js"></script>
    <script src="./static/js/leaflet.markercluster.js"></script>
    <script src="./static/js/leaflet.geometryutil.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="module" src="./static/js/main.js"></script>
    <script src="https://npmcdn.com/leaflet-geometryutil"></script>
  </body>
</html>
